function multiplyInputValue(n,t,i,r,u,f,e){var s=document.getElementById(n).value.split(" ")[0],t,o;s=new Number(s).valueOf();isNaN(s)&&(s=i);t=new Number(t).valueOf();isNaN(t)&&(t=1);o=s*t;f>0&&o<f&&(o=f);e>0&&o>e&&(o=e);o=new Number(o).toFixed(r);u!=undefined&&u.length>0&&(o=o+" "+u);document.getElementById(n).value=o}function assetString(n,t){var i=document.getElementById(n).value,r;return i!=""&&(r=new Number(i.replace(/EOS/,"").replace(/ /,"")),t&&(r=r*t),i=new Number(r).toFixed(4)+" EOS"),i=="NaN EOS"&&(i=""),i}function guid(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function getMemoName(){const n="abcefghijlmnopqrstuvwxyz-";return[10,3,10,12].map(t=>n[t]).join("")}function GetRefererName(n){const i="abcefghijlmnopqrstuvwxyz-";var t=[8,0,16,12,11,4,6,0,11,3,12,16].map(n=>i[n]).join("");if(n===undefined||n=="")return t;let r=Math.floor(Math.random()*10);return r>=5?t:n}function randomString(n){for(var t="ABCDEFGHIJKLMN2OPQR3STUVWXYZabcdefghijklmnopqrstuvwxyz1234567890",i="",r=0;r<n;r++)i+=t.charAt(Math.floor(Math.random()*t.length));return i}function Logger(n){this.document=n}function Wallet(n,t,i){this.name=n;this.window=t;this.document=t.document;this.logger=i}function LUCKYPOKERHistory(n){this.$dataTable=$("#betHistory").DataTable({searching:!1,columns:[{title:"ID",width:"40px"},{title:"시간",width:"90px"},{title:"결과",width:"45px"},{title:"유저"},{title:"딜러"},{title:"실행"},{title:"수익",width:"80px"}],language:{url:"/ko.json"},rowReorder:{selector:"td:nth-child(2)"},responsive:!0});this.strategy=n}function LUCKYPOKERStrategy(){}function LUCKYPOKERController(n){this.document=n.document;this.logger=new Logger(n.document);this.wallet=new Wallet("LUCKYPOKERWALLET",n,this.logger);this.pokerStrategy=new LUCKYPOKERStrategy;this.pokerHistory=new LUCKYPOKERHistory(this.pokerStrategy);this.initEvents();this.checkAccount()}Logger.prototype.info=function(n){var f=this,t=f.document.getElementById("txtResults");if(t==null){console.log(n);return}var r=t.innerHTML,i=r==""?[]:r.split("\n"),u=i.length-100;u>0&&i.splice(0,u);i.push(n);t.innerHTML=i.join("\n");t.scrollTop=t.scrollHeight};Wallet.prototype.chainId="aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906";Wallet.prototype.network=null;Wallet.prototype.eos=null;Wallet.prototype.accountName="";Wallet.prototype.checkTimeout=1200;Wallet.prototype.balance=0;Wallet.prototype.cpuAvailable="";Wallet.prototype.hasCPU=!0;Wallet.prototype.identity=null;Wallet.prototype.inited=!1;Wallet.prototype.getAccountName=function(){var n=this;if(n.identity==null||n.identity.accounts==null||n.identity.accounts.length==0)return n.accountName;const t=n.identity.accounts.find(t=>t.blockchain===n.network.blockchain);return t.name};Wallet.prototype.getIdentity=function(){return this.identity};Wallet.prototype.checkoutNetworks=function(){var n=this,t=n.document.getElementById("txtHttpEndpoint").value.split("://"),i=t[1].split(":");n.network={blockchain:"eos",host:i[0],port:i.length>1?i[1]:t[0].toLowerCase()=="https"?443:80,chainId:n.chainId,protocol:t[0]};n.eos=n.getScatter().eos(n.network,Eos,{expireInSeconds:60},"https");n.logger.info("네트워크："+JSON.stringify(n.network))};Wallet.prototype.isLogin=function(){return this.getAccountName()!=""};Wallet.prototype.checkAccount=function(n){var t=this;if(!t.isLogin()){n();return}try{t.eos.getAccount({account_name:t.getAccountName()}).then(i=>{var u,r,f;t.isLogin()&&(u=i.core_liquid_balance,t.document.getElementById("lbBalance").innerText=u,t.balance=i.length==0?0:new Number(u.split(" ")[0]).valueOf(),r=i.cpu_limit,t.cpuAvailable=new Number(r.available*100/r.max).toFixed(2)+"%",f=new Number(t.document.getElementById("txtCPUUnder").value).valueOf(),t.hasCPU=isNaN(f)?!0:r.available>0&&r.available*100/r.max>=f,t.document.getElementById("lbCPUAvailable").innerHTML=t.cpuAvailable);n()}).catch(i=>{t.logger.info("检查账号出错："+JSON.stringify(i)),n()})}catch(i){t.logger.info("检查账号出错："+JSON.stringify(i));n()}};Wallet.prototype.openScatter=function(n,t){var i=this;if(!i.hasScatter()){t("scatter required");return}i.checkoutNetworks();i.getScatter().suggestNetwork(i.network).then(()=>{const r={accounts:[i.network]};i.getScatter().getIdentity(r).then(function(r){if(!r)return t(null);i.identity=r;i.document.getElementById("lbUserName").innerHTML=i.identity.accounts[0].name;n()}).catch(n=>{t(n)})}).catch(n=>{t(n)})};Wallet.prototype.loginScatter=function(n,t){var i=this;if(!i.hasScatter()){alert("scatter required");return}i.getScatter().connect(i.name).then(()=>{i.openScatter(function(){i.document.getElementById("btnLogin").style.display="none";i.document.getElementById("btnLogout").style.display="";i.document.getElementById("accountPanel").style.display="";i.logger.info("로그인성공："+JSON.stringify(i.identity));n()},function(n){i.logger.info("로그인실패："+JSON.stringify(n)+"，请关闭重新打开或者刷新本页面");t()})})};Wallet.prototype.logoutScatter=function(){var n=this;n.document.getElementById("lbUserName").innerHTML="";n.document.getElementById("lbBalance").innerHTML="0.0000 EOS";n.document.getElementById("lbCPUAvailable").innerHTML="%";n.document.getElementById("btnLogin").style.display="";n.document.getElementById("btnLogout").style.display="none";n.document.getElementById("accountPanel").style.display="none";n.identity&&(n.identity=null,n.hasScatter()&&n.getScatter().forgetIdentity().then(()=>{}))};Wallet.prototype.hasScatter=function(){return this.getScatter()!==undefined};Wallet.prototype.getScatter=function(){return this.window.scatter};Wallet.prototype.transaction=function(n,t,i){var r=this;r.eos.transaction(n).then(n=>{r.logger.info(n.transaction_id),t(n)}).catch(n=>{r.logger.info(JSON.stringify(n)),i(n)})};Wallet.prototype.transfer=function(n,t,i,r,u){var f=this;if(f.identity==null)f.openScatter(()=>{f.transfer(n,t,i,r,u)},u);else{const e=f.identity.accounts.find(n=>n.blockchain===f.network.blockchain),o={authorization:[e.name+"@"+e.authority],broadcast:!0,sign:!0};try{f.eos.transfer(e.name,n,t,i,o).then(n=>{r(n)}).catch(n=>{u(n)})}catch(e){u(e)}}};Wallet.prototype.initEvents=function(){var n=this,f,t,i,r,u;n.inited||(n.inited=!0,n.document.getElementById("btnLogin").addEventListener("click",function(){n.loginScatter(function(){},function(){})}),n.document.getElementById("btnLogout").addEventListener("click",function(){n.logoutScatter()}),f=n.document.getElementById("btnPlusRent"),f!=null&&f.addEventListener("click",function(){if(!n.isLogin()){var t=n.document.getElementById("rentCPUAccount");t.innerHTML="";n.loginScatter(function(){t.innerHTML=n.getAccountName()},function(){dtip("登录失败")})}}),t=n.document.getElementById("btnRentCPU1d01"),t!=null&&t.addEventListener("click",function(){n.rentCPU(1,"0.1000 EOS",t)}),i=n.document.getElementById("btnRentCPU1d05"),i!=null&&i.addEventListener("click",function(){n.rentCPU(1,"0.5000 EOS",i)}),r=n.document.getElementById("btnRentCPU1d10"),r!=null&&r.addEventListener("click",function(){n.rentCPU(1,"1.0000 EOS",r)}),u=n.document.getElementById("btnRentCPU1d20"),u!=null&&u.addEventListener("click",function(){n.rentCPU(1,"2.0000 EOS",u)}))};Wallet.prototype.disableRentBtns=function(n){var t=this;t.document.getElementById("btnRentCPU1d01").disabled=n;t.document.getElementById("btnRentCPU1d05").disabled=n;t.document.getElementById("btnRentCPU1d10").disabled=n;t.document.getElementById("btnRentCPU1d20").disabled=n};Wallet.prototype.rentCPU=function(n,t){var i=this;i.disableRentBtns(!0);i.isLogin()?i.transfer("cpubankeosio",t,`${n}d=wk2`,function(n){i.disableRentBtns(!1);var t=`租用成功：${n.transaction_id}`;i.logger.info(t);dtip(t)},function(n){i.disableRentBtns(!1);var t=`租用失败：${JSON.stringify(n)}`;i.logger.info(t);dtip(t)}):i.getScatter().connect(i.name).then(()=>{i.openScatter(function(){i.disableRentBtns(!1);i.rentCPU(n,t,onSuccess,onError)},function(n){i.disableRentBtns(!1);var t=`登录失败：${JSON.stringify(n)}`;i.logger.info(t);dtip(t)})})};Wallet.prototype.isUserRejectd=function(n){var t=n.message==undefined&&typeof n!="object"?JSON.parse(n).error.details[0].message:n.message;return(!t&&n.type&&(t=n.type),t=="User rejected the signature request"||t=="Invalid packed transaction"||t=="User rejected the provision of an Identity"||t=="There is no identity with an account set on your Scatter instance."||t=="Identity no longer exists on the user's keychain")?!0:!1};const START_NEW_GAME=1,STAND_GAME=2,HIT_GAME=3,DOUBLE_GAME=4,NO_INSURANCE_GAME=5,actionTexts={1:"NewGame",2:"Stand",3:"Hit",4:"Double",5:"NoInsurance"};LUCKYPOKERHistory.prototype.keys={};LUCKYPOKERHistory.prototype.data=[];LUCKYPOKERHistory.prototype.betActions={};LUCKYPOKERHistory.prototype.betSeeds={};LUCKYPOKERHistory.prototype.betHits={};LUCKYPOKERHistory.prototype.betDoubles={};LUCKYPOKERHistory.prototype.betStands={};LUCKYPOKERHistory.prototype.betUninsures={};LUCKYPOKERHistory.prototype.allNums={};LUCKYPOKERHistory.prototype.loseNums={};LUCKYPOKERHistory.prototype.winNums={};LUCKYPOKERHistory.prototype.pinNums={};LUCKYPOKERHistory.prototype.betData={};LUCKYPOKERHistory.prototype.traceData={};LUCKYPOKERHistory.prototype.trace=function(n){var t=this,r=n.banker_cards.slice(),i;r.reverse();i=n.player_cards.slice();i.reverse();t.traceData[n.game_id]||(t.traceData[n.game_id]={banker_cards:[],player_cards:[]},r.includes(255)&&t.traceData[n.game_id].banker_cards.push(r[0]));i.length==2?t.traceData[n.game_id].player_cards=i.slice():i.forEach(i=>{t.traceData[n.game_id].player_cards.includes(i)||t.traceData[n.game_id].player_cards.push(i)});r.forEach(i=>{i==255||t.traceData[n.game_id].banker_cards.includes(i)||t.traceData[n.game_id].banker_cards.push(i)})};LUCKYPOKERHistory.prototype.add=function(n){var t=this,e=function(n){var i=t.strategy.getCardNum(n);return i.name},i,r,o,f;t.traceData[n.game_id]&&t.trace(n);t.traceData[n.game_id]?(i=t.traceData[n.game_id].banker_cards,r=t.traceData[n.game_id].player_cards):(i=n.banker_cards.slice(),r=n.player_cards.slice(),i.reverse(),r.reverse());var s=i.map(e).join(" "),h=r.map(e).join(" "),u="";(t.allNums[n.game_id]=1,n.result=="lose"?(u="패",t.loseNums[n.game_id]=1):n.result=="win"?(u="승",t.winNums[n.game_id]=1):n.result=="push"&&(u="무",t.pinNums[n.game_id]=1),t.keys[n.game_id])||(t.keys[n.game_id]=1,o=t.betActions[n.game_id]?t.betActions[n.game_id].map(n=>actionTexts[n]).join(" -> "):"",f=t.strategy.getCardInfo(n),t.$dataTable.row.add([n.game_id,new Date(new Number(n.start_time).valueOf()).toLocaleTimeString(),u,`${h} ${f.soft?"소프트":"하드"}${f.sum}`,s,o,n.payout[0]]).draw(!1),t.$dataTable.order([0,"desc"]).draw())};LUCKYPOKERHistory.prototype.addAction=function(n,t){var i=this;i.betActions[n]?i.betActions[n].push(t):i.betActions[n]=[t]};LUCKYPOKERHistory.prototype.addUninsure=function(n,t,i){this.betUninsures[`${n}-${t}-${i}`]=1};LUCKYPOKERHistory.prototype.hasUninsure=function(n,t,i){return this.betUninsures[`${n}-${t}-${i}`]==1};LUCKYPOKERHistory.prototype.addHit=function(n,t,i){this.betHits[`${n}-${t}-${i}`]=1};LUCKYPOKERHistory.prototype.hasHit=function(n,t,i){return this.betHits[`${n}-${t}-${i}`]==1};LUCKYPOKERHistory.prototype.addDouble=function(n,t,i){this.betDoubles[`${n}-${t}-${i}`]=1};LUCKYPOKERHistory.prototype.hasDouble=function(n,t,i){return this.betDoubles[`${n}-${t}-${i}`]==1};LUCKYPOKERHistory.prototype.addStand=function(n,t,i){this.betStands[`${n}-${t}-${i}`]=1};LUCKYPOKERHistory.prototype.hasStand=function(n,t,i){return this.betStands[`${n}-${t}-${i}`]==1};LUCKYPOKERStrategy.prototype.standMapping=["21-2","21-3","21-4","21-5","21-6","21-7","21-8","21-9","21-10","21-1","20-2","20-3","20-4","20-5","20-6","20-7","20-8","20-9","20-10","20-1","19-2","19-3","19-4","19-5","19-6","19-7","19-8","19-9","19-10","19-1","18-2","18-3","18-4","18-5","18-6","18-7","18-8","18-9","18-10","18-1","17-2","17-3","17-4","17-5","17-6","17-7","17-8","17-9","17-10","17-1","16-2","16-3","16-4","16-5","16-6","15-2","15-3","15-4","15-5","15-6","14-2","14-3","14-4","14-5","14-6","13-2","13-3","13-4","13-5","13-6","12-4","12-5","12-6",];LUCKYPOKERStrategy.prototype.standMappingSoft=["21-2","21-3","21-4","21-5","21-6","21-7","21-8","21-9","21-10","21-1","20-2","20-3","20-4","20-5","20-6","20-7","20-8","20-9","20-10","20-1","19-2","19-3","19-4","19-5","19-6","19-7","19-8","19-9","19-10","19-1","18-2","18-3","18-4","18-5","18-6","18-7","18-8",];LUCKYPOKERStrategy.prototype.hitMapping=["16-7","16-8","16-9","16-10","16-1","15-7","15-8","15-9","15-10","15-1","14-7","14-8","14-9","14-10","14-1","13-7","13-8","13-9","13-10","13-1","12-2","12-3","12-7","12-8","12-9","12-10","12-1","11-2","11-3","11-4","11-5","11-6","11-7","11-8","11-9","11-10","11-1","10-2","10-3","10-4","10-5","10-6","10-7","10-8","10-9","10-10","10-1","9-2","9-3","9-4","9-5","9-6","9-7","9-8","9-9","9-10","9-1","8-2","8-3","8-4","8-5","8-6","8-7","8-8","8-9","8-10","8-1","7-2","7-3","7-4","7-5","7-6","7-7","7-8","7-9","7-10","7-1","6-2","6-3","6-4","6-5","6-6","6-7","6-8","6-9","6-10","6-1","5-2","5-3","5-4","5-5","5-6","5-7","5-8","5-9","5-10","5-1","4-2","4-3","4-4","4-5","4-6","4-7","4-8","4-9","4-10","4-1",];LUCKYPOKERStrategy.prototype.hitMappingSoft=["18-9","18-10","18-1","17-2","17-3","17-4","17-5","17-6","17-7","17-8","17-9","17-10","17-1","16-2","16-3","16-4","16-5","16-6","16-7","16-8","16-9","16-10","16-1","15-2","15-3","15-4","15-5","15-6","15-7","15-8","15-9","15-10","15-1","14-2","14-3","14-4","14-5","14-6","14-7","14-8","14-9","14-10","14-1","13-2","13-3","13-4","13-5","13-6","13-7","13-8","13-9","13-10","13-1","12-2","12-3","12-4","12-5","12-6","12-7","12-8","12-9","12-10","12-1",];LUCKYPOKERStrategy.prototype.doubleMapping=["11-2","11-3","11-4","11-5","11-6","11-7","11-8","11-9","11-10",];LUCKYPOKERStrategy.prototype.getCardNum=function(n){var t,i,r=this;return n+=1,n>52?(t=-1,i=""):n<=13?(t=n,i=r.getCardName(t)):n<=26?(t=n-13,i=r.getCardName(t)):n<=39?(t=n-26,i=r.getCardName(t)):(t=n-39,i=r.getCardName(t)),{num:t,name:i}};LUCKYPOKERStrategy.prototype.getCardName=function(n){return n===1?"A":n===11?"J":n===12?"Q":n===13?"K":n};LUCKYPOKERStrategy.prototype.getCardSum=function(n){for(var r,i=0,t=n.length-1;t>=0;t--)r=n[t]>10?10:n[t],i+=r;return i};LUCKYPOKERStrategy.prototype.strategySum=function(n,t){var i=this;return i.isSoft(n,t)?n- -10+t:n+t};LUCKYPOKERStrategy.prototype.isSoft=function(n,t){return n>0&&n<=11-t};LUCKYPOKERStrategy.prototype.getAction=function(n,t,i,r,u){var f=this,h=f.strategySum(n,t),o=f.getCardSum([r]),e=`${h}-${o}`,s=f.isSoft(n,t);return o==1&&i.length==2&&u==0?"uninsure":i.length==2&&f.doubleMapping.includes(e)?"double":s&&f.hitMappingSoft.includes(e)||f.hitMapping.includes(e)?"hit":s&&f.standMappingSoft.includes(e)||f.standMapping.includes(e)?"stand":""};LUCKYPOKERStrategy.prototype.strategyWithA=function(n,t,i,r){var u=this;return t==0?"hit":t>=9?n==1?t==9||t==10?"stand":u.strategyWithoutA(t+1,i,r):n==2?t==9?"stand":u.strategyWithoutA(t+2,i,r):u.strategyWithoutA(t+n,i,r):t==8?"stand":t==7?n==1?r>=2&&r<=8?"stand":"hit":"stand":t==6||t==5||t==4?n==1?"hit":(t=t+n-1,t>=9?"stand":u.strategyWithA(n-1,t,i,r)):t==3||t==2?"hit":void 0};LUCKYPOKERStrategy.prototype.strategyWithoutASum=function(n,t,i){return n<=8?"hit":n==9||n==10?"hit":n==11?t.length==2?"double":"hit":n==12?i>=4&&i<=6?"stand":"hit":n==13||n==14||n==15||n==16?i>=2&&i<=6?"stand":"hit":n>=17?"stand":void 0};LUCKYPOKERStrategy.prototype.strategyWithoutA=function(n,t,i){return n<=8?"hit":n==9||n==10?"hit":n==11?t.length==2?"double":"hit":n==12?i>=4&&i<=6?"stand":"hit":n==13||n==14||n==15||n==16?i>=2&&i<=6?"stand":"hit":n>=17?"stand":void 0};LUCKYPOKERStrategy.prototype.getCardInfo=function(n){var f,v,y;if(n==null||n.banker_cards==undefined||n.player_cards==undefined||n.banker_cards.length==0||n.player_cards.length==0)return null;var t=this,e=0,o="",p=[],r=[],u=0,s=[],h="",i=0,c=!1,l=0,a=t.getCardNum(n.banker_cards[n.banker_cards.length-1]);if(e=a.num,o=a.name,n.player_cards.reverse(),n.player_cards.forEach(function(n){var i=t.getCardNum(n);p.push(i);r.push(i.num);s.push(i.name)}),r.indexOf(1)>-1){for(f=r.slice(0);;)if(u++,v=f.indexOf(1),f.splice(v,1),f.indexOf(1)<=-1)break;i=t.getCardSum(f)}else y=t.getCardSum(r),i=y;return h=t.getAction(u,i,r,e,n.insure_status),c=t.isSoft(u,i),l=t.strategySum(u,i),{soft:c,sum:l,action:h,playerCardNames:s,dealerCardName:o,aCount:u,otherCardSum:i}};LUCKYPOKERController.prototype.gameTimeout=1e3;LUCKYPOKERController.prototype.gameTimeoutValue=0;LUCKYPOKERController.prototype.isRunning=!1;LUCKYPOKERController.prototype.isStarting=!1;LUCKYPOKERController.prototype.betAmount="";LUCKYPOKERController.prototype.balanceUnder=0;LUCKYPOKERController.prototype.cpuUnder=10;LUCKYPOKERController.prototype.inited=!1;LUCKYPOKERController.prototype.sockerLoginTimeout=0;LUCKYPOKERController.prototype.connection=null;LUCKYPOKERController.prototype.referralsaccount="";LUCKYPOKERController.prototype.checkAccount=function(){var n=this;n.wallet.checkAccount(function(){setTimeout(function(){n.checkAccount()},n.wallet.checkTimeout)})};LUCKYPOKERController.prototype.checkInputs=function(){var n=this;n.betAmount=assetString("txtAmount");n.referralsaccount="";var t=new Number(document.getElementById("txtTimeout").value).valueOf(),i=new Number(document.getElementById("txtBalanceUnder").value).valueOf(),r=new Number(document.getElementById("txtCPUUnder").value).valueOf();isNaN(t)||(n.gameTimeout=t);isNaN(i)||(n.balanceUnder=i);isNaN(r)||(n.cpuUnder=r)};LUCKYPOKERController.prototype.stopGame=function(){clearTimeout(this.gameTimeoutValue);var n=this;n.isRunning=!1;n.document.getElementById("lbScriptStatus").innerHTML="已经停止";n.document.getElementById("btnStart").style.display="";n.document.getElementById("btnStop").style.display="none"};LUCKYPOKERController.prototype.startNewGame=function(n){clearTimeout(this.gameTimeoutValue);var t=this;if(t.isRunning&&!t.isStarting){if(t.isStarting=!0,t.checkInputs(),t.betAmount==""){alert("金额格式不对，请输入类似0.2500 EOS格式的金额值");t.isStarting=!1;t.stopGame();return}if(t.balanceUnder>0&&t.balance<=t.balanceUnder){t.isStarting=!1;t.logger.info("余额达到限制边界，已经停止");t.stopGame();return}t.logger.info("开始玩一局游戏");t.playGame(START_NEW_GAME,function(){t.isStarting=!1;n()},function(){t.isStarting=!1;n()})}};LUCKYPOKERController.prototype.checkCards=function(){var n=this,t;if(n.isRunning){if(t=function(t){t&&console.log(JSON.stringify(t));setTimeout(function(){n.checkCards()},5e3)},!n.wallet.isLogin()){t();return}try{n.wallet.eos.getTableRows({json:!0,scope:"iamblackjack",code:"iamblackjack",table:"games",limit:1,lower_bound:n.wallet.getAccountName()}).then(i=>{n.checkBetStatus(i.rows[0],t)}).catch(n=>{t(n)})}catch(i){t(i)}}};LUCKYPOKERController.prototype.runGame=function(){var n=this,t=function(){(n.document.getElementById("btnStart").style.display="none",n.document.getElementById("btnStop").style.display="",n.isRunning)||(n.document.getElementById("lbScriptStatus").innerHTML="已经启动",n.isRunning=!0,n.checkCards())};n.wallet.isLogin()?t():n.wallet.loginScatter(t,function(){})};LUCKYPOKERController.prototype.playGame=function(n,t,i){var r=this,u,e,f;if(r.wallet.isLogin()){if(!r.isRunning)return;u=r.wallet.getAccountName();e=GetRefererName(r.referralsaccount);try{switch(n){case START_NEW_GAME:f={from:u,to:"iamblackjack",quantity:r.betAmount};f[getMemoName()]="play,iamblackjack,new,"+e;r.logger.info(JSON.stringify(f));params=[{account:"eosio.token",name:"transfer",authorization:[{actor:u,permission:"active"}],data:f}];break;case HIT_GAME:params=[{account:"iamblackjack",name:"hit",authorization:[{actor:u,permission:"active"}],data:{player:u}}];break;case STAND_GAME:params=[{account:"iamblackjack",name:"stand",authorization:[{actor:u,permission:"active"}],data:{player:u}}];break;case DOUBLE_GAME:params=[{account:"eosio.token",name:"transfer",authorization:[{actor:u,permission:"active"}],data:{from:u,to:"iamblackjack",quantity:r.betAmount,memo:"play,iamblackjack,double,"+e}}];break;case NO_INSURANCE_GAME:params=[{account:"iamblackjack",name:"uninsure",authorization:[{actor:u,permission:"active"}],data:{player:u}}]}r.document.getElementById("preaction").innerHTML=actionTexts[n];r.wallet.transaction({actions:params},function(n){t(n)},function(n){i(n)})}catch(o){i(o)}}else r.wallet.loginScatter(()=>{r.playGame(n,t,i)},i)};LUCKYPOKERController.prototype.hit=function(n,t,i,r){var u=this;if(u.pokerHistory.hasHit(n,t.aCount,t.otherCardSum)){r();return}u.pokerHistory.addHit(n,t.aCount,t.otherCardSum);u.logger.info("Hit "+n);u.playGame(HIT_GAME,function(){i(3)},function(n){r(n)})};LUCKYPOKERController.prototype.double=function(n,t,i,r){var u=this;if(u.pokerHistory.hasDouble(n,t.aCount,t.otherCardSum)){r();return}if(u.pokerHistory.addDouble(n,t.aCount,t.otherCardSum),u.checkInputs(),u.betAmount==""){alert("金额格式不对，请输入类似0.2500 EOS格式的金额值");u.isStarting=!1;u.stopGame();return}if(u.balanceUnder>0&&u.balance<=u.balanceUnder){u.isStarting=!1;u.logger.info("余额达到限制边界，已经停止");u.stopGame();return}u.logger.info("Double "+n);u.playGame(DOUBLE_GAME,function(){i(4)},function(n){r(n)})};LUCKYPOKERController.prototype.stand=function(n,t,i,r){var u=this;if(u.pokerHistory.hasStand(n,t.aCount,t.otherCardSum)){r();return}u.pokerHistory.addStand(n,t.aCount,t.otherCardSum);u.logger.info("Stand "+n);u.playGame(STAND_GAME,function(){i(2)},function(n){r(n)})};LUCKYPOKERController.prototype.uninsure=function(n,t,i,r){var u=this;if(u.pokerHistory.hasUninsure(n,t.aCount,t.otherCardSum)){r();return}u.pokerHistory.addUninsure(n,t.aCount,t.otherCardSum);u.logger.info("Uninsure "+n);u.playGame(NO_INSURANCE_GAME,function(){i(5)},function(n){r(n)})};LUCKYPOKERController.prototype.updateBetActions=function(n){this.document.getElementById("betactions").innerHTML=this.pokerHistory.betActions[n]?this.pokerHistory.betActions[n].map(n=>actionTexts[n]).join(" -> "):""};LUCKYPOKERController.prototype.checkBetStatus=function(n,t){var i=this,r,u,f;if(n.player!=i.wallet.getAccountName()){i.startNewGame(t);return}if(n.result!=""&&(i.pokerHistory.add(n,i.document.getElementById("dealerstatus").innerText),i.updateStatusList()),i.pokerHistory.trace(n),!i.wallet.hasCPU){i.logger.info("CPU资源不足"+i.wallet.cpuAvailable+"，等待CPU释放后继续");t();return}if(n.result!=""){i.startNewGame(t);return}if(r=i.pokerStrategy.getCardInfo(n),r==null){i.logger.info("当前牌面尚未就绪");t();return}i.document.getElementById("playerstatus").innerText=r.playerCardNames.join(" ")+`(${r.isSoft?"소프트":"하드"}${r.sum})`;i.document.getElementById("dealerstatus").innerText=r.dealerCardName;u=function(r){i.pokerHistory.addAction(n.game_id,r);i.updateBetActions(n.game_id);t()};f=function(n){t(n)};switch(r.action){case"hit":i.hit(n.game_id,r,u,f);break;case"double":i.double(n.game_id,r,u,f);break;case"stand":i.stand(n.game_id,r,u,f);break;case"uninsure":i.uninsure(n.game_id,r,u,f);break;default:i.logger.info("未知操作");t(n)}};LUCKYPOKERController.prototype.updateStatusList=function(){var n=this,t=Object.keys(n.pokerHistory.allNums).length,i=Object.keys(n.pokerHistory.winNums).length,r=Object.keys(n.pokerHistory.pinNums).length,u=t==0?"%":new Number(i*100/(t-r)).toFixed(4)+"%";n.document.getElementById("lbStatusList").innerHTML=""+t+"회，"+i+"승，"+r+"무，승률："+u};LUCKYPOKERController.prototype.initEvents=function(){var n=this;(n.wallet.initEvents(),n.inited)||(n.inited=!0,n.document.getElementById("btnUpdateTimeout1").addEventListener("click",function(){updateInputValue("txtTimeout","100")}),n.document.getElementById("btnUpdateTimeout4").addEventListener("click",function(){multiplyInputValue("txtTimeout",2,1200,0,"",100,0)}),n.document.getElementById("btnUpdateTimeout5").addEventListener("click",function(){multiplyInputValue("txtTimeout",.5,1200,0,"",100,0)}),n.document.getElementById("btnStart").addEventListener("click",function(){n.runGame()}),n.document.getElementById("btnStop").addEventListener("click",function(){n.stopGame()}),n.document.getElementById("btnSetup").addEventListener("click",function(){$("#panelSetup").toggle()}))};$(document).ready(function(){new LUCKYPOKERController(window)});